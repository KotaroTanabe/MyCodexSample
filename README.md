# Mahjong Web App

1人用（AI 3人を含む）シングルページ麻雀アプリ
Codex/CopilotなどAI補助によるコーディング演習・検証用プロジェクト

https://kotarotanabe.github.io/MyCodexSample/

---

## 特徴

主な機能を以下にまとめます。詳細は [docs/features.md](docs/features.md) を参照してください。

### 基本
- プレイヤー1名＋AI3名の四人打ち
- React + Vite + TypeScript 製SPA
- ブラウザのみで完結しPC/スマホ両対応

### 主なゲーム機能
- 東風戦・半荘戦・1局戦から選択（デフォルトは半荘戦）
- 局ごとの牌譜（[天鳳JSON形式](https://tenhou.net/6)）をエクスポート可能
- シンプルなAI思考ルーチン（向聴数を落とさない牌を優先）
- 高度なAI思考ルーチン切替オプション（ツールモーダル内）

### クイズ/ログ機能
- 符計算、点数、向聴数、受け入れ枚数クイズ
- LQ/MJAI/Tenhou形式のログ出力とコピー

その他の開発メモは [docs/development-notes.md](docs/development-notes.md) にまとめています。

## クイックスタート

### 1. クローン & セットアップ

このプロジェクトは `.nvmrc` で指定している **Node.js 20.x** を前提にビルドして
います。`nvm` を利用している場合は以下のように実行してください。Node.js 21 以
降では依存パッケージとの互換性問題でビルドやテストが失敗することがあります。
動作が不安定な場合は必ず `nvm use` で `.nvmrc` のバージョンに合わせてください。

```sh
git clone https://github.com/KotaroTanabe/MyCodexSample.git
cd MyCodexSample
nvm use
npm install
```

### 2. 開発サーバ起動

```sh
npm run dev
```
- ブラウザで `http://localhost:5173/` を開く
- 鳴き可能なときは画面下部に「チー」「ポン」「カン」ボタンが表示されます。クリックして副露できます。

### 3. ビルド & ローカル確認

```sh
npm run build
npm run preview
```
- `dist/` 配下が成果物。
- `npm run preview` でローカル起動（SPAルーティング考慮）

### 4. テスト実行

```sh
npm test
```
- 実行前に **必ず** `npm install` (または `npm ci`) を実行して依存パッケージをインストールする

### 5. Lint

```sh
npm run lint
```
- `.eslintrc.json` を利用した ESLint 設定で、TypeScript/React のコードをチェックできます。

### 符計算クイズモード

- 画面上部のモード切替ドロップダウンから「符計算クイズ」を選ぶと、通常の対局モードからクイズモードへ切り替えられます。
- 提示される和了形の符を入力すると、ゲームと同じ得点計算ロジックで答え合わせを行います。
- 同じドロップダウンで「ゲーム」を再度選ぶと通常プレイへ戻ります。
- 各問題ではロンかツモかも表示され、毎回ランダムに決定されます。

### 点数計算クイズモード

- モードを「点数クイズ」に切り替えると、翻数と符数を基に最終得点を当てるクイズが遊べます。
- 解答時には正解の点数に加え、何翻何符かも表示されます。

### 向聴数クイズモード

- モードを「向聴数クイズ」に切り替えると、ランダムな手牌の向聴数を当てるクイズが遊べます。
- デバッグ用途としても利用でき、現在の実装で計算された向聴数とその根拠を確認できます。解答ではアルゴリズムの計算過程をそのまま表示します。


---

## CI/CD（GitHub Actions & Pages）

- **push/PR時に自動ビルド・テスト**
- 成功時 `dist` アーティファクトをダウンロード可能
- PR作成時にプレビュー環境へ自動デプロイ
  - Actionsのワークフロー実行ページの"Deploy to GitHub Pages"ステップに表示される`Preview URL`からアクセス
- mainブランチpush時に **GitHub Pagesへ自動デプロイ**
- PR作成時は **Pagesプレビュー** を自動発行（`steps.deployment.outputs.page_url` を確認）
- 公開URL例：
  `https://kotarotanabe.github.io/MyCodexSample/`

### 成果物をダウンロードして動作確認

1. [Actionsタブ](https://github.com/KotaroTanabe/MyCodexSample/actions)で最新ジョブを選択
2. `dist` アーティファクトをダウンロード
3. zip展開して `index.html` をダブルクリック

---

## デプロイ

- GitHub Pages, Netlify等で `dist/` を静的公開するだけでOK
- `vite.config.js` の `base` をリポジトリ名に合わせて必ず修正

---

## 構成・主要ファイル

- `src/`
  - `types/mahjong.ts` … 牌・プレイヤー等の型定義
  - `components/` … React各種コンポーネント
- `public/` … favicon等
- `tailwind.config.js`, `postcss.config.js` … CSSビルド
- `vite.config.js` … Pages対応
- `.github/workflows/ci.yml` … CIワークフロー

詳細な牌の回転ロジックについては [docs/rotation-utils.md](docs/rotation-utils.md) を参照してください。

---

## ヘルプモーダル（役一覧）

スコアボード右側の「?」ボタンをクリックすると、標準的な役一覧をすべて確認できるモーダルが開きます。各役の門前/副露ごとの翻数と簡単な説明を表形式で表示します。閉じる場合はモーダル右上の「×」を押してください。

---
詳細なルールと役の実装状況は [docs/rules.md](docs/rules.md) を参照してください。


## 牌譜エクスポート

対局ログは `.lq.GameDetailRecords` 形式でダウンロードできます。ヘッダーの
📄 アイコンから開くメニューで「ログダウンロード」を選ぶと、開始・終了時刻やプレイヤー情報を含む JSON ファイルが保存されます。
同様に同メニューの「MJAIログダウンロード」から、Mortal互換の `.jsonl` 形式で牌譜を取得できます。
Tenhou形式ログを直接クリップボードにコピーするボタンも局結果・和了結果画面に追加しました。

## 実装予定・進捗

- [x] 他家の手牌枚数表示
- [x] 河・手牌・鳴き牌スペースの固定化と枠線表示
- [x] 鳴き牌スペースを座席に合わせて回転表示
- [x] 枠線表示の切替と背景ラベル（枠非表示でラベルも隠れる）
- [x] 向聴数を考慮したAI打牌
- [x] 受け入れ枚数を考慮したAI打牌
- [x] 中央に局情報・ドラ表示を配置
- [x] AIの鳴き・リーチ判断を改善
- [x] 局情報とドラ表示の縦並びレイアウト
- [x] 上家・下家の手牌枚数表示を河横へ移動
- [x] 河の向きを席順基準で固定
  - [x] プレイヤーとAIのリーチ処理を共通化
- [x] 観戦モード切替時の鳴き自動選択
- [x] 鳴き牌スペースを四隅に再配置
- [x] 複数鳴き時は縦方向に4フーロ分まで積み上げ表示
- [x] 自家の鳴き牌スペースを河の右側へ移動
- [x] 全員鳴きプリセットを追加
- [x] 和了結果に手牌とあたり牌を表示
- [x] 和了結果であがり牌をテキスト表示
- [x] 和了結果で表ドラ・裏ドラ表示
- [x] 役表示にドラ枚数を追加
- [x] ツモ和了時の点数表記を n点オール / n点-2n点 に変更
- [x] 牌譜解析（外部サイト）リンク
- [x] MJAIログ出力対応
- [x] Tenhouログ出力対応
- [x] Tenhouログのクリップボードコピー
- [x] Tenhouログコピー時にトースト通知
- [x] Tenhouログに符・飜・点数と役情報を追加
- [x] Tenhouログで役牌を詳細表示
- [x] 天鳳牌譜エディタURL生成ボタン
- [x] 局進行時に親が持ち回る
- [x] 未確認牌枚数を求めるヘルパー追加
- [x] 受け入れ枚数ヘルパーとクイズ追加
- [x] リーチ後のツモ/カン不可時に自動ツモ切り
- [x] 親がAIの場合は自動で打牌開始
- [x] Favicon設定
- [x] 赤5ルール（任意枚数）
- [x] 高度なAI思考ルーチン切替
- [x] 聴牌時にあがり牌をツールチップ表示

---

## ライセンス

MIT
